## Показания джойстика  
<img src="https://github.com/SuperBaumanets/PeripheryMC/blob/main/KY-023/ky023.png?raw=true" />

## Массивы
### uint16_t KY023_VRXVRY[]  
Массив значений выводов VRX и VRY, отвечающих за "координаты" по оси X и Y в диапазоне от 0 до 4096
**KY023_VRXVRY[0]:** значение вывода VRX(ось X)  
**KY023_VRXVRY[1]:** значение вывода VRY(ось Y)  

### uint8_t KY023_EffortsVRXVRY[]  
Массив, содержащий процент отклонения стика джойстика от центра координат(2046; 2046) до крайних положений по всем осям. Записываемый диапазон лежит от 0 до 100.  
**KY023_EffortsVRXVRY[0]:** процент отклонения вывода VRX от центра до крайнего левого положения (от 2046 до 0)  
**KY023_EffortsVRXVRY[1]:** процент отклонения вывода VRX от центра до крайнего правого положения (от 2046 до 4096)  
**KY023_EffortsVRXVRY[2]:** процент отклонения вывода VRY от центра до крайнего верхнего положения (от 2046 до 0)  
**KY023_EffortsVRXVRY[3]:** процент отклонения вывода VRY от центра до крайнего нижнего положения (от 2046 до 4096)  
*Все значения координат положения стика джойстика указаны по умолчанию*

### uint16_t KY023_CursorVRXVRY[]  
Массив, содержащий количество пикселей для перемещения по экрану  
**KY023_CursorVRXVRY[0]:** количество пикселей для перемещения в левую сторону  
**KY023_CursorVRXVRY[1]:** количество пикселей для перемещения в правую сторону  
**KY023_CursorVRXVRY[2]:** количество пикселей для перемещения в вверх  
**KY023_CursorVRXVRY[3]:** количество пикселей для перемещения в вниз  

## Функции
### void KY023_Init(t_KY023 *ptrky023, GPIO_TypeDef *_portVRX, uint16_t _pinVRX, GPIO_TypeDef *_portVRY,  uint16_t _pinVRY, GPIO_TypeDef *_portSW,  uint16_t _pinSW)
Функция инициализирует такие параметры джойстика как:  
порт, пин вывода VRX  
порт, пин вывода VRY
порт, пин вывода SW
записывая их в структуру t_KY023.
Также устанавливается значение чувствительности по умолчанию - равное 1(см. ниже подробнее про чувствительность)  
- **Параметры**  
**ptrky023:** адрес переменной типа t_KY023   
**_portVRX:** указатель на порт вывода VRX  
**_pinVRX:** пин вывода VRX
**_portVRY:** указатель на порт вывода VRY  
**_pinVRY:** пин вывода VRY
**_portSW:** указатель на порт вывода SW
**_pinSW:** пин вывода SW

### void KY023_Processing(t_KY023 *ptrky023, uint16_t time)  
Функция вычисляет состояние выводов VRX, VRY и SW(кнопкa). Возможные сосотаяния кнопки:  
*buttonShortPress* - короткое нажатие кнопки(120 милли секунд)  
*buttonLongPress* - долгое нажатие кнопки(1 секунда)  
*buttonDoublePress* - двойное нажатие кнопки(2 нажатия кнопки за время меньшее 120 милли секунд)
- **Параметры**  
**ptrky023:** адрес переменной типа t_KY023   
**time:** шаг времени, необходимый для вычисления состояния кнопки 

### void KY023_GetVRXVRY(t_KY023 *ptrky023) 
Функция записывает в массив KY023_VRXVRY текущее значение "координаты" по оси VRX и VRY  
- **Параметры**  
**ptrky023:** адрес переменной типа t_KY023   

### void KY023_GetEffortVRXVRY(t_KY023 *ptrky023)
Функция записывает в массив KY023_EffortsVRXVRY текущее значение процента отклонения стика джойстика от центра координат до крайних положений по всем осям.  
- **Параметры**  
**ptrky023:** адрес переменной типа t_KY023   

### void KY023_SetSensitivity(t_KY023 *ptrky023, uint8_t sensitivity)
Функция устанавливает чувствительность джойтика. Устанавливаемая чувствительнсоть задает количесвто dpi.  
dpi в данной библиотеке принимается равное количеству пикселей на перемещение стика джойтиска в крайнее положение  
*Пример: dpi = 4 будет соответствовать перемещению курсора на 4 пикселя при положении стика в любом крайнем положении*  
- **Параметры**  
**ptrky023:** адрес переменной типа t_KY023  
**sensitivity** устанавливаемая чувствительность джойстика:  
sensitivity = 1 -> 1 dpi  
sensitivity = 2 -> 2 dpi  
sensitivity = 3 -> 4 dpi  
sensitivity = 4 -> 8 dpi  
sensitivity = 5 -> 16 dpi  
sensitivity = 6 -> 32 dpi  

### void KY023_CursorMode(t_KY023 *ptrky023)
Функция предназначена для управления указателем на экране (использование джойстика в качестве "мышки"). Реализована чувствительность управления - то, насколько реагирует указатель  
при перемещении стика джойстика. При более высокой чувствительности указатель движется быстрее и проходит большее расстояние.  
*Пример: dpi = 4. Отклонение стика в крайнее положении будет соответствовать перемещению указателя на 4 пикселя, отклонение стика на 3/4 от крайнего положения соответствует перемещеию указателя  
на 3 пикеселя, отклонение стика на 1/2 от крайнего положения соответствует перемещеию указателя на 2 пикеселя и тд.*  
- **Параметры**  
**ptrky023:** адрес переменной типа t_KY023

### int16_t KY023_GetAngle(t_KY023 *ptrky023, angle ANGLEPI)
Функция возвращает угол положения стика джойстика. Возможно 2 варианта возврата значения: первый **TWOPI** - возвращаемый угол лежит в пределах от 0 до 360 градусов,  
второй **PNPI** - возвращаемый угол лежит в пределах от 0 до 180 градусов для вращения вращения стика по часовой стрелки и от 0 до -180 градусов для вращения вращения стика против часовой стрелки. 
- **Параметры**  
**ptrky023:** адрес переменной типа t_KY023  
**ANGLEPI:** задает вариант возврата угла (TWOPI/PNPI)

## Инициализация
Создать переменную типа t_Bttn
```C
t_KY023 testKY023;
```
Вызвать функцию инициализации.
```C
KY023_Init(&testKY023, GPIOA, GPIO_PIN_0, GPIOA, GPIO_PIN_1, GPIOE, GPIO_PIN_7);
```
Создать до цикла while(1) можно установить чувствительность джойстика(если подключен экран!)
```C
KY023_SetSensitivity(&testKY023, 2);
```
В цикле while вызвать функцию KY023_Processing(&testKY023, 10), для вычисления состояния выводов VRX, VRY и SW.
```C
while (1)
{
  KY023_Processing(&testKY023, 10);
  HAL_Delay(10);
  
  // Пример работы с курсором: Вывод числа пискелей для перемещения в сторону перемещения стика 
  // и отрисовка пикселя в получившихся координатах
  // (приведен пример с работы с микросхемой ST7735S и библиотекой st7735.h)
  //-----------------------------------------------------------------------------------------------
  KY023_CursorMode(&testKY023);
  
  ST7735S_SetCursor(0, 40, 0);
  ST7735S_PrintIntNum(KY023_CursorVRXVRY[0], ST7735_COLOR_WHITE, 1, 1);
  
  ST7735S_SetCursor(0, 50, 0);
  ST7735S_PrintIntNum(KY023_CursorVRXVRY[1], ST7735_COLOR_WHITE, 1, 1);
  
  ST7735S_SetCursor(0, 60, 0);
  ST7735S_PrintIntNum(KY023_CursorVRXVRY[2], ST7735_COLOR_WHITE, 1, 1);
  
  ST7735S_SetCursor(0, 70, 0);
  ST7735S_PrintIntNum(KY023_CursorVRXVRY[3], ST7735_COLOR_WHITE, 1, 1);
  
  int i;
  for(i = 0; i < 4; i++){
    if(KY023_CursorVRXVRY[i] != pixelYest[i])
      ST7735S_DrawFillRectangle(0,40, 17, 37, ST7735_COLOR_BLACK);
  }
  for(i = 0; i < 4; i++){
    pixelYest[i] = KY023_CursorVRXVRY[i];
  }
  
  x = x - KY023_CursorVRXVRY[0];
  x = x + KY023_CursorVRXVRY[1];
  y = y - KY023_CursorVRXVRY[2];
  y = y + KY023_CursorVRXVRY[3];
  ST7735S_DrawPixel(x,y, ST7735_COLOR_ORANGE);
  //-----------------------------------------------------------------------------------------------
  
  // Работа с функциями KY023_GetVRXVRY(t_KY023 *ptrky023) и KY023_GetEffortVRXVRY(t_KY023 *ptrky023) аналогична
```
